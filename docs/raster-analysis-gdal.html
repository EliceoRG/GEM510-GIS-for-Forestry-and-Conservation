<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Lab 5 Raster analysis with GDAL | GEM 510: GIS for Forestry and Conservation</title>
  <meta name="description" content="Open Educational Resources for GEM 510 course at the University of British Columbia" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Lab 5 Raster analysis with GDAL | GEM 510: GIS for Forestry and Conservation" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Open Educational Resources for GEM 510 course at the University of British Columbia" />
  <meta name="github-repo" content="github.com/ubc-geomatics-community-of-practice/GEM510-GIS-for-Forestry-and-Conservation/book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Lab 5 Raster analysis with GDAL | GEM 510: GIS for Forestry and Conservation" />
  
  <meta name="twitter:description" content="Open Educational Resources for GEM 510 course at the University of British Columbia" />
  

<meta name="author" content="Paul D. Pickell" />


<meta name="date" content="2023-08-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="qgis-openstreetmap.html"/>
<link rel="next" href="digitization-editing-kart.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>



<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">An Open Geomatics Community of Practice</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-use-these-resources"><i class="fa fa-check"></i>How to use these resources</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-get-involved"><i class="fa fa-check"></i>How to get involved</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction-postgresql-postgis.html"><a href="introduction-postgresql-postgis.html"><i class="fa fa-check"></i><b>1</b> Introduction to PostgreSQL and PostGIS</a>
<ul>
<li class="chapter" data-level="" data-path="introduction-postgresql-postgis.html"><a href="introduction-postgresql-postgis.html#lab-overview"><i class="fa fa-check"></i>Lab Overview</a></li>
<li class="chapter" data-level="" data-path="introduction-postgresql-postgis.html"><a href="introduction-postgresql-postgis.html#learning-objectives"><i class="fa fa-check"></i>Learning Objectives</a></li>
<li class="chapter" data-level="" data-path="introduction-postgresql-postgis.html"><a href="introduction-postgresql-postgis.html#lab1-deliverables"><i class="fa fa-check"></i>Deliverables</a></li>
<li class="chapter" data-level="" data-path="introduction-postgresql-postgis.html"><a href="introduction-postgresql-postgis.html#data"><i class="fa fa-check"></i>Data</a></li>
<li class="chapter" data-level="" data-path="introduction-postgresql-postgis.html"><a href="introduction-postgresql-postgis.html#task-1-set-up-pgadmin-and-connect-to-the-ubc-postgresql-server"><i class="fa fa-check"></i>Task 1: Set up pgAdmin and Connect to the UBC PostgreSQL server</a></li>
<li class="chapter" data-level="" data-path="introduction-postgresql-postgis.html"><a href="introduction-postgresql-postgis.html#task-2-explore-with-qgis"><i class="fa fa-check"></i>Task 2: Explore with QGIS</a></li>
<li class="chapter" data-level="" data-path="introduction-postgresql-postgis.html"><a href="introduction-postgresql-postgis.html#task-3-explore-with-arcgis-pro"><i class="fa fa-check"></i>Task 3: Explore with ArcGIS Pro</a></li>
<li class="chapter" data-level="" data-path="introduction-postgresql-postgis.html"><a href="introduction-postgresql-postgis.html#task-4-explore-with-psql-shell"><i class="fa fa-check"></i>Task 4: Explore with psql Shell</a></li>
<li class="chapter" data-level="" data-path="introduction-postgresql-postgis.html"><a href="introduction-postgresql-postgis.html#summary"><i class="fa fa-check"></i>Summary</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="analyze-relational-database.html"><a href="analyze-relational-database.html"><i class="fa fa-check"></i><b>2</b> Analyze a Relational Database</a>
<ul>
<li class="chapter" data-level="" data-path="analyze-relational-database.html"><a href="analyze-relational-database.html#lab-overview-1"><i class="fa fa-check"></i>Lab Overview</a></li>
<li class="chapter" data-level="" data-path="analyze-relational-database.html"><a href="analyze-relational-database.html#learning-objectives-1"><i class="fa fa-check"></i>Learning Objectives</a></li>
<li class="chapter" data-level="" data-path="analyze-relational-database.html"><a href="analyze-relational-database.html#lab2-deliverables"><i class="fa fa-check"></i>Deliverables</a></li>
<li class="chapter" data-level="" data-path="analyze-relational-database.html"><a href="analyze-relational-database.html#data-1"><i class="fa fa-check"></i>Data</a></li>
<li class="chapter" data-level="" data-path="analyze-relational-database.html"><a href="analyze-relational-database.html#task-1-host-your-own-postgresql-server"><i class="fa fa-check"></i>Task 1: Host your own PostgreSQL Server</a></li>
<li class="chapter" data-level="" data-path="analyze-relational-database.html"><a href="analyze-relational-database.html#task-2-create-a-postgis-database"><i class="fa fa-check"></i>Task 2: Create a PostGIS Database</a></li>
<li class="chapter" data-level="" data-path="analyze-relational-database.html"><a href="analyze-relational-database.html#task-3-import-spatial-data-using-gdal"><i class="fa fa-check"></i>Task 3: Import Spatial Data Using GDAL</a></li>
<li class="chapter" data-level="" data-path="analyze-relational-database.html"><a href="analyze-relational-database.html#task-4-analyze-a-postgis-database-using-sql"><i class="fa fa-check"></i>Task 4: Analyze a PostGIS Database using SQL</a></li>
<li class="chapter" data-level="" data-path="analyze-relational-database.html"><a href="analyze-relational-database.html#summary-1"><i class="fa fa-check"></i>Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="suitability-overlay-analysis.html"><a href="suitability-overlay-analysis.html"><i class="fa fa-check"></i><b>3</b> Suitability and Overlay Analysis</a>
<ul>
<li class="chapter" data-level="" data-path="suitability-overlay-analysis.html"><a href="suitability-overlay-analysis.html#lab-overview-2"><i class="fa fa-check"></i>Lab Overview</a></li>
<li class="chapter" data-level="" data-path="suitability-overlay-analysis.html"><a href="suitability-overlay-analysis.html#learning-objectives-2"><i class="fa fa-check"></i>Learning Objectives</a></li>
<li class="chapter" data-level="" data-path="suitability-overlay-analysis.html"><a href="suitability-overlay-analysis.html#lab3-deliverables"><i class="fa fa-check"></i>Deliverables</a></li>
<li class="chapter" data-level="" data-path="suitability-overlay-analysis.html"><a href="suitability-overlay-analysis.html#data-2"><i class="fa fa-check"></i>Data</a>
<ul>
<li class="chapter" data-level="" data-path="suitability-overlay-analysis.html"><a href="suitability-overlay-analysis.html#data-organization"><i class="fa fa-check"></i>Data Organization</a></li>
<li class="chapter" data-level="" data-path="suitability-overlay-analysis.html"><a href="suitability-overlay-analysis.html#files-to-create"><i class="fa fa-check"></i>Files to Create</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="suitability-overlay-analysis.html"><a href="suitability-overlay-analysis.html#task-1-export-relevant-data-from-biologically-important-areas-shapefile"><i class="fa fa-check"></i>Task 1: Export Relevant Data from Biologically Important Areas Shapefile</a></li>
<li class="chapter" data-level="" data-path="suitability-overlay-analysis.html"><a href="suitability-overlay-analysis.html#task-2-identify-the-bia-of-the-humpback-whale-that-is-not-within-the-established-marine-sanctuary"><i class="fa fa-check"></i>Task 2: Identify the BIA of the Humpback Whale that is not within the established Marine Sanctuary</a></li>
<li class="chapter" data-level="" data-path="suitability-overlay-analysis.html"><a href="suitability-overlay-analysis.html#task-3-calculate-the-density-of-cetacean-sightings-using-the-bia-for-humpback-whales"><i class="fa fa-check"></i>Task 3: Calculate the Density of Cetacean Sightings using the BIA for Humpback Whales</a></li>
<li class="chapter" data-level="" data-path="suitability-overlay-analysis.html"><a href="suitability-overlay-analysis.html#task-4-extract-the-boats-from-ocean-uses-and-identity-the-vessels-within-the-bia-polygons"><i class="fa fa-check"></i>Task 4: Extract the Boats from Ocean Uses and Identity the Vessels within the BIA Polygons</a></li>
<li class="chapter" data-level="" data-path="suitability-overlay-analysis.html"><a href="suitability-overlay-analysis.html#task-5-calculate-suitability-and-identify-most-suitable-locations-for-the-marine-sanctuary"><i class="fa fa-check"></i>Task 5: Calculate Suitability and Identify Most Suitable Locations for the Marine Sanctuary</a></li>
<li class="chapter" data-level="" data-path="suitability-overlay-analysis.html"><a href="suitability-overlay-analysis.html#summary-2"><i class="fa fa-check"></i>Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="qgis-openstreetmap.html"><a href="qgis-openstreetmap.html"><i class="fa fa-check"></i><b>4</b> Exploring QGIS and OpenStreetMap</a>
<ul>
<li class="chapter" data-level="" data-path="qgis-openstreetmap.html"><a href="qgis-openstreetmap.html#lab-overview-3"><i class="fa fa-check"></i>Lab Overview</a></li>
<li class="chapter" data-level="" data-path="qgis-openstreetmap.html"><a href="qgis-openstreetmap.html#learning-objectives-3"><i class="fa fa-check"></i>Learning Objectives</a></li>
<li class="chapter" data-level="" data-path="qgis-openstreetmap.html"><a href="qgis-openstreetmap.html#lab4-deliverables"><i class="fa fa-check"></i>Deliverables</a></li>
<li class="chapter" data-level="" data-path="qgis-openstreetmap.html"><a href="qgis-openstreetmap.html#data-3"><i class="fa fa-check"></i>Data</a></li>
<li class="chapter" data-level="" data-path="qgis-openstreetmap.html"><a href="qgis-openstreetmap.html#task-1-downloading-openstreetmap-data-to-qgis"><i class="fa fa-check"></i>Task 1: Downloading OpenStreetMap data to QGIS</a></li>
<li class="chapter" data-level="" data-path="qgis-openstreetmap.html"><a href="qgis-openstreetmap.html#task-2-inspecting-and-processing-openstreetmap-data"><i class="fa fa-check"></i>Task 2: Inspecting and processing OpenStreetMap data</a></li>
<li class="chapter" data-level="" data-path="qgis-openstreetmap.html"><a href="qgis-openstreetmap.html#task-3-simple-spatial-analysis-with-qgis"><i class="fa fa-check"></i>Task 3: Simple spatial analysis with QGIS</a></li>
<li class="chapter" data-level="" data-path="qgis-openstreetmap.html"><a href="qgis-openstreetmap.html#summary-3"><i class="fa fa-check"></i>Summary</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="raster-analysis-gdal.html"><a href="raster-analysis-gdal.html"><i class="fa fa-check"></i><b>5</b> Raster analysis with GDAL</a>
<ul>
<li class="chapter" data-level="" data-path="raster-analysis-gdal.html"><a href="raster-analysis-gdal.html#lab-overview-4"><i class="fa fa-check"></i>Lab Overview</a></li>
<li class="chapter" data-level="" data-path="raster-analysis-gdal.html"><a href="raster-analysis-gdal.html#learning-objectives-4"><i class="fa fa-check"></i>Learning Objectives</a></li>
<li class="chapter" data-level="" data-path="raster-analysis-gdal.html"><a href="raster-analysis-gdal.html#lab5-deliverables"><i class="fa fa-check"></i>Deliverables</a></li>
<li class="chapter" data-level="" data-path="raster-analysis-gdal.html"><a href="raster-analysis-gdal.html#data-4"><i class="fa fa-check"></i>Data</a></li>
<li class="chapter" data-level="" data-path="raster-analysis-gdal.html"><a href="raster-analysis-gdal.html#task-1-define-a-raster-area-of-interest"><i class="fa fa-check"></i>Task 1: Define a raster area of interest</a></li>
<li class="chapter" data-level="" data-path="raster-analysis-gdal.html"><a href="raster-analysis-gdal.html#task-2-seamless-mosaicking"><i class="fa fa-check"></i>Task 2: Seamless mosaicking</a></li>
<li class="chapter" data-level="" data-path="raster-analysis-gdal.html"><a href="raster-analysis-gdal.html#task-3-calculate-derivative-rasters"><i class="fa fa-check"></i>Task 3: Calculate derivative rasters</a></li>
<li class="chapter" data-level="" data-path="raster-analysis-gdal.html"><a href="raster-analysis-gdal.html#task-4-weighted-raster-overlay"><i class="fa fa-check"></i>Task 4: Weighted raster overlay</a></li>
<li class="chapter" data-level="" data-path="raster-analysis-gdal.html"><a href="raster-analysis-gdal.html#summary-4"><i class="fa fa-check"></i>Summary</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="digitization-editing-kart.html"><a href="digitization-editing-kart.html"><i class="fa fa-check"></i><b>6</b> Digitization and Editing with Kart</a>
<ul>
<li class="chapter" data-level="" data-path="digitization-editing-kart.html"><a href="digitization-editing-kart.html#lab-overview-5"><i class="fa fa-check"></i>Lab Overview</a></li>
<li class="chapter" data-level="" data-path="digitization-editing-kart.html"><a href="digitization-editing-kart.html#learning-objectives-5"><i class="fa fa-check"></i>Learning Objectives</a></li>
<li class="chapter" data-level="" data-path="digitization-editing-kart.html"><a href="digitization-editing-kart.html#lab6-deliverables"><i class="fa fa-check"></i>Deliverables</a></li>
<li class="chapter" data-level="" data-path="digitization-editing-kart.html"><a href="digitization-editing-kart.html#data-5"><i class="fa fa-check"></i>Data</a></li>
<li class="chapter" data-level="" data-path="digitization-editing-kart.html"><a href="digitization-editing-kart.html#task-1-install-kart-and-create-your-first-repository"><i class="fa fa-check"></i>Task 1: Install Kart and create your first repository</a></li>
<li class="chapter" data-level="" data-path="digitization-editing-kart.html"><a href="digitization-editing-kart.html#task-2-edit-a-layer-in-qgis-with-version-control"><i class="fa fa-check"></i>Task 2: Edit a layer in QGIS with version control</a></li>
<li class="chapter" data-level="6.1" data-path="digitization-editing-kart.html"><a href="digitization-editing-kart.html#task-3-working-on-and-merging-different-branches"><i class="fa fa-check"></i><b>6.1</b> Task 3: Working on and merging different branches</a></li>
<li class="chapter" data-level="6.2" data-path="digitization-editing-kart.html"><a href="digitization-editing-kart.html#task-4-digitize-some-buildings-in-arcgis-pro"><i class="fa fa-check"></i><b>6.2</b> Task 4: Digitize some buildings in ArcGIS Pro</a></li>
<li class="chapter" data-level="" data-path="digitization-editing-kart.html"><a href="digitization-editing-kart.html#summary-5"><i class="fa fa-check"></i>Summary</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">GEM 510: GIS for Forestry and Conservation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="raster-analysis-gdal" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Lab 5</span> Raster analysis with GDAL<a href="raster-analysis-gdal.html#raster-analysis-gdal" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Written by
Paul Pickell</p>
<div id="lab-overview-4" class="section level2 unnumbered hasAnchor">
<h2>Lab Overview<a href="raster-analysis-gdal.html#lab-overview-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this lab, you will explore many of the different raster operations using the Geospatial Data Abstraction Library (GDAL). GDAL is implemented in most popular GIS software, but we will practice using these utilities directly from the command line. You will create</p>
<hr />
</div>
<div id="learning-objectives-4" class="section level2 unnumbered hasAnchor">
<h2>Learning Objectives<a href="raster-analysis-gdal.html#learning-objectives-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><p>Describe the raster data model</p></li>
<li><p>Convert between image coordinates and geographic coordinates</p></li>
<li><p>Convert vector data to raster and vice-versa</p></li>
<li><p>Distinguish bit depths in rasters and identify appropriate encoding of sampled values for different phenomena</p></li>
<li><p>Evaluate expressions on rasters using arithmetic, relational, and boolean operators</p></li>
<li><p>Calculate cumulative viewsheds</p></li>
<li><p>Combine rasters and calculate weighted overlays</p></li>
<li><p>Calculate least cost paths and corridors of a landscape indicator species</p></li>
</ul>
<hr />
</div>
<div id="lab5-deliverables" class="section level2 unnumbered hasAnchor">
<h2>Deliverables<a href="raster-analysis-gdal.html#lab5-deliverables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><p>Lorem ipsum</p></li>
<li><p>Lorem ipsum</p></li>
<li><p>Lorem ipsum</p></li>
</ul>
<hr />
</div>
<div id="data-4" class="section level2 unnumbered hasAnchor">
<h2>Data<a href="raster-analysis-gdal.html#data-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>All data for this lab are accessible via the UBC PostgreSQL server. Instructions for connecting to the server are given in prior labs.</p>
<hr />
</div>
<div id="task-1-define-a-raster-area-of-interest" class="section level2 unnumbered hasAnchor">
<h2>Task 1: Define a raster area of interest<a href="raster-analysis-gdal.html#task-1-define-a-raster-area-of-interest" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Our first task is to define an Area of Interest (AOI) that will represent the extent of all of our raster processing.</p>
<p><strong>Step 1:</strong> Open QGIS and create a new project named “GrizzlyBear”.</p>
<p><strong>Step 2:</strong> Connect to the <code>bear</code> database on the UBC PostgreSQL server and load the “grizzlybearmanagementareas” layer into your map. These polygons represent the Grizzly Bear population units or Bear Management Areas (BMA) in the Rocky Mountain foothills of Alberta (<a href="https://open.alberta.ca/licence">Alberta Open Government License</a>). For this lab, we will be focusing on the Yellowhead BMA for our AOI.</p>
<p><strong>Step 3:</strong> Write an SQL query to select the Yellowhead BMA and then export it to your local QGIS project folder as a shapefile named “yellowhead_bma.shp”, and change the “CRS” to NAD83 / UTM zone 11N (EPSG:26911).</p>
<p>We are going to rasterize this layer and do the basic raster processing outside of QGIS/ArcGIS Pro for a couple of reasons. First, setting the options and raster processing environments in QGIS/ArcGIS Pro is overly complicated and prone to error and unexpected behaviour. Second, you will learn how to use some valuable raster processing utilities of GDAL that can be easily batched and run in chain sequence (i.e., you can batch process large research datasets from a command line).</p>
<p><strong>Step 4:</strong> Open the OSGeo4W shell and navigate to your QGIS project folder using the change directory <code>cd</code> command. To do this, first copy the path of your project folder, usually something like <code>C:\Users\paul\Documents\QGIS\GrizzlyBear</code>. Then in the console type <code>cd C:\Users\paul\Documents\QGIS\GrizzlyBear</code> to change to that directory.</p>
<p>The first GDAL utility we are going to use is <code>gdal_rasterize</code> (<a href="https://gdal.org/programs/gdal_rasterize.html">link to documentation</a>). This utility takes a vector input datasource and converts it to a raster in the output. The simplest usage is <code>gdal_rasterize &lt;src_datasource&gt; &lt;dst_filename&gt;</code>. All of the flags preceded by <code>-</code> are indicated as optional by the square brackets <code>[]</code>. If you do not use any of the flags when you run the utility, then the utility will use the default values/settings for those flags that are indicated in the documentation. The AOI raster we are going to create will specify a few conditions of all the other raster processing we will do:</p>
<ul>
<li>raster extent (number of rows/columns and geographic coordinates)</li>
<li>pixel/cell resolution</li>
<li>spatial reference system</li>
</ul>
<p><strong>Step 5:</strong> In the OSGeo4W shell, enter the following command <code>gdal_rasterize -burn 1 -tr 10 10 -ot "Byte" -tap yellowhead_bma_utm.shp yellowhead_bma_utm.tif</code>.</p>
<p><code>-burn</code> flag indicates we want to assign a value of <code>1</code> to the output raster where the features intersect the new raster grid.
<code>-tr</code> flag indicates we want the output cell resolution to be 10 m (we know its meters because those are the units of the coordinate system) and this is specified twice <code>10 10</code>, once for the x-axis and again for the y-axis.
<code>-ot</code> flag indicates that we want the output data type of the raster to be <code>"Byte"</code>, which translates to a storage cost of 8 bits per pixel (bits per pixel × rows × columns = size of raster on disk).
<code>-tap</code> flag (target aligned pixels) indicates that we want the new raster extent to be calculated using floor and ceiling functions:</p>
<pre><code>ymax (top) = y_resolution × ceiling(ymax / y_resolution) = 10 × ceiling(5,936,280.447609 / 10) = 10 × 593,629 = 5,936,290
ymin (bottom) = y_resolution × floor(ymin / y_resolution) = 10 × floor(5,753,454.574941 / 10) = 10 × 575,345 = 5,753,450
xmin (left) = x_resolution × floor(xmin / x_resolution) = 10 × floor(401,496.997149 / 10) = 10 × 40,149 = 401,490
xmax (right) = x_resolution × ceiling(xmax / x_resolution) = 10 × ceiling(661,663.194125 / 10) = 10 × 66,167 = 661,670</code></pre>
<p>The above calculations are probably not immediately intuitive, but the idea is that we want to create a raster grid that is aligned to the ceiling and floor of our x- and y-resolution. The overall size of the raster is the same whether we do this alignment or not (same number of rows and columns), the only difference is that we are shifting the grid so that the extent coordinates are whole numbers (integers), which makes it easier for us to compute new grids. Bring “yellowhead_bma_utm.tif” into QGIS to inspect it. Check that the values, extent, cell size, and coordinate system are correct. You can also run the <code>gdalinfo</code> utility to check the metadata from the command line like <code>gdalinfo yellowhead_bma_utm.tif</code>.</p>
<hr />
</div>
<div id="task-2-seamless-mosaicking" class="section level2 unnumbered hasAnchor">
<h2>Task 2: Seamless mosaicking<a href="raster-analysis-gdal.html#task-2-seamless-mosaicking" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A common task in raster analysis is mosaicking multiple rasters together to perform analysis on a single file over a larger extent. We will practice doing this with some ASTER Digital Elevation Models (DEM) that are distributed as non-overlapping tiles in WGS 1984 (EPSG:4326). The source for these data can be found at <a href="https://search.earthdata.nasa.gov">NASA’s Earth Science Data Systems portal</a>, but we will be retrieving these data from the UBC PostgreSQL server instead.</p>
<p><strong>Step 1:</strong> Open your QGIS project and from the “Data Source Manager” connect to the <code>bear</code> database of the UBC PostgreSQL server. You should see a listing of 15 rasters there, which have names prefixed with “astgtmv003”. Select all 15 and then click “Add”. It is very important that you add the rasters using this method rather than from the “Browser” pane, otherwise you might have unexpected errors.</p>
<p><img src="images/05-qgis-data-source-manager.png" width="75%" /></p>
<p><strong>Step 2:</strong> Open the “Layer Properties” for “astgtmv003_n51w115” and inspect the extent values and the pixel size.</p>
<div id="q1.-what-units-are-the-extent-and-pixel-size-in-1-point" class="section level5 unnumbered hasAnchor">
<h5>Q1. What units are the extent and pixel size in? (1 point)<a href="raster-analysis-gdal.html#q1.-what-units-are-the-extent-and-pixel-size-in-1-point" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>If you are wondering why the y pixel size is negative, it is to facilitate the conversion between image coordinates and geographic/projected coordinates. Image coordinates are the unique combination of rows <code>i</code> and columns <code>j</code> representing each pixel in the image. By convention, the origin <code>(0,0)</code> for image coordinates is the upper left corner of the image. Image coordinates are always positive and increase as you move down the image to the lower right corner at <code>(n,m)</code>, where <code>n</code> is the number of columns in the image (think x-axis) and <code>m</code> is the number of rows in the image (think y-axis). Most geographic and projected coordinate systems decrease along the y-axis (as you move south), which is the inverse of image coordinates that are increasing. Thus, the y pixel size is usually stored as a negative number in order to convert image coordinates into geographic/projected coordinates.</p>
<p>For example, to convert pixel <code>(i,j)</code> from image coordinates to geographic coordinates where the image origin <code>(0,0)</code> corresponds to geographic coordinates <code>(-115.0001388888889977,52.0001388888888982)</code> as is the case for “astgtmv003_n51w115” and the x pixel size is <code>0.000277778</code> and the y pixel size is <code>-0.000277778</code>:</p>
<pre><code>Longitude(i) = -115.0001388888889977 + i × 0.000277778
Latitude(j) = 52.0001388888888982 + j × -0.000277778</code></pre>
</div>
<div id="q2.-given-the-equations-above-what-is-the-exact-latitude-and-longtiude-of-the-pixel-with-image-coordinates-19071918-show-your-work-for-full-credit.-4-points" class="section level5 unnumbered hasAnchor">
<h5>Q2. Given the equations above, what is the exact latitude and longtiude of the pixel with image coordinates (1907,1918)? Show your work for full credit. (4 points)<a href="raster-analysis-gdal.html#q2.-given-the-equations-above-what-is-the-exact-latitude-and-longtiude-of-the-pixel-with-image-coordinates-19071918-show-your-work-for-full-credit.-4-points" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p><strong>Step 3:</strong> Copy the coordinates from Q2 and paste them into the “Coordinate” field at the bottom of your QGIS screen (see image below) in the format <code>latitude, longitude</code> and press “Enter”. Change the scale to <code>1:500</code> and press “Enter”. You should now be able to distinguish individual pixels. Click the coordinate reference system at the bottom right of the screen and change it from the default value of <code>EPSG:4326</code> (WGS 1984) to <code>EPSG:26911</code> (NAD 1983 UTM Zone 11N).</p>
<p><img src="images/05-qgis-project-srs.png" width="100%" /></p>
</div>
<div id="q3.-why-do-the-pixels-now-appear-to-be-elongated-along-the-y-axis-2-points" class="section level5 unnumbered hasAnchor">
<h5>Q3. Why do the pixels now appear to be elongated along the y-axis? (2 points)<a href="raster-analysis-gdal.html#q3.-why-do-the-pixels-now-appear-to-be-elongated-along-the-y-axis-2-points" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p><strong>Step 4:</strong> Save your PostgreSQL credential to your QGIS environment variables by opening the Python console in QGIS, click the small “Show editor” button, and then paste the following into the editor and click the “Run” button:</p>
<pre><code>import os

os.environ[&#39;PGUSER&#39;] = &#39;student&#39;
os.environ[&#39;PGPASSWORD&#39;] = &#39;studentpasswordhere&#39;
</code></pre>
<p><img src="images/05-qgis-python-environment-variables.png" width="75%" /></p>
<p>This step will automatically authenticate you each time you need to transact with the PostgreSQL server through the GDAL utilities. Your credential is only saved for the duration of your QGIS session, so once you close QGIS and re-open your project, you will need to come back to this step to save your environment variables. Close the python console and editor when you are done.</p>
<p><strong>Step 5:</strong> From the QGIS processing toolbox, search for the “Build virtual raster” tool. This tool takes a set of rasters as input and essentially creates a catalog of those data for later processing. Click the ellipse “…” next to the “Input Layers” field and then click “Select All” to toggle on all the ASTER DEMs currently in your project. Click “Run”. The tool does not actually create a new raster file, but what you will see is that you can now manipulate this catalog of rasters as if it were a single file, which is very handy for mosaicking. Notice when you run these GDAL tools, the log shows you the exact GDAL command that you can run in the command line, like we did in Task 1.</p>
<p><strong>Step 6:</strong> The GDAL utility that will actually make the mosaic is <code>gdal_translate</code>, which is really just a utility for converting between different raster formats. We are going to use it to read in the virtual raster and write out a GeoTiff. Search for the tool in the processing toolbox, “Translate”, make sure you are using the tool under “Raster Conversion”. Make sure the virtual raster is selected for “Input layer” and then click the ellipse “…” next to the “Converted” field, “Save to file…”, and then name the output “aster_dem_wgs84.tif”. Click “Run” and then inspect the output in QGIS. Notice that we did not download any of the raster data to our local machine until this very last step.</p>
<p><img src="images/05-qgis-translate.png" width="75%" /></p>
<p>The mosaic still needs to be reprojected and clipped to the same extent as our AOI, which is what we will do in the next step using the <code>gdalwarp</code> utility. The QGIS tool, “Warp”, does not expose all the options that we need, so we will do this next step in the OSGeo4W shell.</p>
<p><strong>Step 7:</strong> Open the OSGeo4W shell and navigate to your project folder where you saved “aster_dem_wgs84.tif”. Type the following command into the console and then hit “Enter”: <code>gdalwarp -s_srs EPSG:4326 -t_srs EPSG:26911 -te 401490 5753450 661670 5936290 -tr 10 10 -r cubic aster_dem_wgs84.tif aster_dem_utm.tif</code>.</p>
<p><img src="images/05-osgeo4w-gdalwarp.png" width="100%" /></p>
<ul>
<li><p><code>-s_srs</code> flag defines the input spatial reference system (coordinate system), which is WGS 1984 or <code>EPSG:4326</code>.</p></li>
<li><p><code>-t_srs</code> flag defines our target SRS, which is NAD 1983 UTM Zone 11N or <code>EPSG:26911</code>.</p></li>
<li><p><code>-te</code> flag defines our target extent <code>xmin ymin xmax ymax</code>, which is the calculation we did in Task 1 <code>401490 5753450 661670 5936290</code>.</p></li>
<li><p><code>-tr</code> flag defines the target resolution, again specified twice for both axes <code>10 10</code>.</p></li>
<li><p><code>-r</code> flag defines the re-sampling method. This is an important flag for <code>gdalwarp</code> because any time that you re-project a raster, you are resampling that raster. The term “resampling” comes from the fact that a raster is “sampled” to begin with. Each cell in a raster is a sample of some random variable over the extent of the raster, and the value of that sample is correct for the center of the cell. When we re-project a raster, the locations of the cells change, therefore we need to recalculate the samples or “resample” the raster. Our selected method of resampling in this case is <code>cubic</code>, which is a smoothing algorithm and well-suited for continuous data like elevation.</p></li>
<li><p><code>aster_dem_wgs84.tif</code> is the input raster and <code>aster_dem_utm.tif</code> is the output (resampled) raster. Inspect the output in QGIS.</p></li>
</ul>
<p>Note that we did not use the <code>-ot</code> output data type flag, so <code>gdalwarp</code> used the <code>Int16</code> data type of our input raster. If you set <code>-ot Float32</code>, then you would see that the cubic resampling algorithm actually yields decimals instead of the integers that you see in the current output, but for our purposes that sub-meter level of precision is not needed.</p>
<p><strong>Step 8:</strong> Search for the GDAL “Raster Calculator” tool and add the “aster_dem_utm.tif” mosaic as “Input layer A” and the “yellowhead_bma_utm.tif” mask as “Input layer B”. Change “Number of raster band for B” to “Band 1 (Gray)” then scroll down to the field that says “Calculation in gdalnumeric syntax […]”. Here we are simply going to type <code>A*B</code> because we want to create a mask of our DEM for only our AOI. Scroll down further and click the ellipse “…” next to the “Calculated” field to save the output as “aster_dem_utm_aoi.tif”. Click “Run” and then inspect the output in your map.</p>
</div>
<div id="q-describe-the-relationship-between-resampling-method-and-pixel-size" class="section level5 unnumbered hasAnchor">
<h5>Q Describe the relationship between resampling method and pixel size<a href="raster-analysis-gdal.html#q-describe-the-relationship-between-resampling-method-and-pixel-size" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<hr />
</div>
</div>
<div id="task-3-calculate-derivative-rasters" class="section level2 unnumbered hasAnchor">
<h2>Task 3: Calculate derivative rasters<a href="raster-analysis-gdal.html#task-3-calculate-derivative-rasters" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this task, we will calculate a few derivatives from the ASTER DEM mosaic.</p>
<p><strong>Step 1:</strong> Open your QGIS project and search for the</p>
<p><strong>Step 2:</strong></p>
<p><strong>Step 3:</strong></p>
<hr />
</div>
<div id="task-4-weighted-raster-overlay" class="section level2 unnumbered hasAnchor">
<h2>Task 4: Weighted raster overlay<a href="raster-analysis-gdal.html#task-4-weighted-raster-overlay" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Step 1:</strong></p>
<p><strong>Step 2:</strong></p>
<p><strong>Step 3:</strong></p>
<p>gdal_proximity.py - calculate distance to a road
gdaldem slope
gdaldem aspect
gdal_viewshed - calculate several viewsheds and produce cumulative viewshed heat map
gdal_calc.py - reclassify
least cost path in QGIS</p>
<hr />
</div>
<div id="summary-4" class="section level2 unnumbered hasAnchor">
<h2>Summary<a href="raster-analysis-gdal.html#summary-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Return to the <strong><a href="raster-analysis-gdal.html#lab5-deliverables">Deliverables</a></strong> section to check off everything you need to submit for credit in the course management system.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="qgis-openstreetmap.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="digitization-editing-kart.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["open-geomatics-community-of-practice.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
